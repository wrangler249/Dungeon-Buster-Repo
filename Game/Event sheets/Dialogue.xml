<?xml version="1.0" encoding="utf-8" ?>
<c2eventsheet>
    <!--All the 'name' attributes are ignored by Construct 2 - they are there for readability only.-->
    <name>Dialogue</name>
    <events>
        <variable constant="0" name="busterCanQuitConversation" static="0" type="number">0</variable>
        <variable comment="Can Buster talk now?" constant="0" name="busterCanTalk" static="0" type="number">0</variable>
        <variable comment="What step is it in the conversation?" constant="0" name="dialogueStep" static="0" type="number">0</variable>
        <comment>---</comment>
        <comment>Each NPC capable of dialogue must have a conversationID attached to it. This ID distinguishes each conversation and must be named descriptively, ie &quot;[Character Name][Character Name]_[Scene]&quot; would be something like &quot;BusterHarry_Argument1&quot;</comment>
        <comment>---</comment>
        <comment>The &quot;dialogueStep&quot; variable is used to signify what stage the converation is at. This is used when another character starts talking or a new sentence is started. Always remember to reset this variable back to 0 either at the end of a dialogue sequence or at the very beginning (ie this should be the first action carried out) whena new conversation is starting.</comment>
        <comment>---</comment>
        <comment>**This variable is handled by its own event schedule** The &quot;busterCanTalk&quot; variable is used as a boolean, with 0 being &quot;true&quot; and 1 being &quot;false&quot;. This is used as a cooldown after a conversation has finished, allowing the player to move away from the NPC without accidentally initiating the conversation again. This was implemented because of an infinite conversation problem where the player would press &apos;e&apos; at the end of a conversation and immediately trigger the same conversation again.</comment>
        <comment>---</comment>
        <comment>busterCanQuitConversation is used when the player reaches the end of the conversation. It is set in the last step of a conversation and is immediately reset to 0 in the following conversation end schedule.</comment>
        <comment>---</comment>
        <comment>Check the example below for an insight into how the conversation system should be used.</comment>
        <comment>---</comment>
        <event-block>
            <conditions>
                <condition id="-2" name="On start of layout" type="System" />
            </conditions>
            <actions>
                <action id="-4" name="Set layer visible" type="System">
                    <param id="0" name="Layer">&quot;Dialogue&quot;</param>
                    <param id="1" name="Visibility">0</param>
                </action>
            </actions>
        </event-block>
        <event-group collapsed="1" description="" title="Example">
            <sub-events>
                <comment>Set the player character timescale to 0, preventing them from moving around during dialogue sequences. Also set the dialogue layer to visible.</comment>
                <event-block collapsed="1">
                    <conditions>
                        <condition id="0" name="On key pressed" type="Keyboard">
                            <param id="0" name="Key">69 (E)</param>
                        </condition>
                        <condition id="-8" name="Compare two values" type="System">
                            <param id="0" name="First value">distance(buster.X,buster.Y,mrtest.x,mrtest.Y)</param>
                            <param id="1" name="Comparison">3</param>
                            <param id="2" name="Second value">20</param>
                        </condition>
                        <condition id="-14" name="Compare variable" type="System">
                            <param id="0" name="Variable">busterCanTalk</param>
                            <param id="1" name="Comparison">0</param>
                            <param id="2" name="Value">0</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="-14" name="Set object time scale" type="System">
                            <param id="0" name="Object">Buster</param>
                            <param id="1" name="Time scale">0</param>
                        </action>
                        <action id="-4" name="Set layer visible" type="System">
                            <param id="0" name="Layer">&quot;Dialogue&quot;</param>
                            <param id="1" name="Visibility">1</param>
                        </action>
                    </actions>
                    <sub-events>
                        <comment>Check the NPCs conversationID and then keep each step of the conversation as a subevent of this parent event.</comment>
                        <event-block>
                            <conditions>
                                <condition id="-4" name="Trigger once while true" type="System" />
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block>
                                    <conditions>
                                        <condition id="-7" name="Compare instance variable" type="MrTest">
                                            <param id="0" name="Instance variable">conversationID</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">&quot;BusterMrTest_TestConversation&quot;</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <comment>Each step should begin with the sentence dialogue being set, then a wait period (1 second or more) before setting the dialogue step variable up 1. **Do NOT use the add function, always use the set function.** When the &apos;e&apos; key is pressed after this, the conversation dialogue will change to the next step.</comment>
                                        <event-block>
                                            <conditions>
                                                <condition id="-14" name="Compare variable" type="System">
                                                    <param id="0" name="Variable">dialogueStep</param>
                                                    <param id="1" name="Comparison">0</param>
                                                    <param id="2" name="Value">0</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="0" name="Set text" type="DialogueText">
                                                    <param id="0" name="Text">&quot;Hurrrrrrrrr&quot;</param>
                                                </action>
                                                <action id="-16" name="Wait" type="System">
                                                    <param id="0" name="Seconds">1.0</param>
                                                </action>
                                                <action id="-9" name="Set value" type="System">
                                                    <param id="0" name="Variable">dialogueStep</param>
                                                    <param id="1" name="Value">1</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                        <event-block>
                                            <conditions>
                                                <condition id="-14" name="Compare variable" type="System">
                                                    <param id="0" name="Variable">dialogueStep</param>
                                                    <param id="1" name="Comparison">0</param>
                                                    <param id="2" name="Value">1</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="0" name="Set text" type="DialogueText">
                                                    <param id="0" name="Text">&quot;Durrrr&quot;</param>
                                                </action>
                                                <action id="-16" name="Wait" type="System">
                                                    <param id="0" name="Seconds">1.0</param>
                                                </action>
                                                <action id="-9" name="Set value" type="System">
                                                    <param id="0" name="Variable">dialogueStep</param>
                                                    <param id="1" name="Value">2</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                        <comment>The final step of the conversation should NOT add one to the dialogueStep variable (it should also not reset the variable to 0 here). Instead, set the busterCanQuitConversation variable to 1.</comment>
                                        <event-block>
                                            <conditions>
                                                <condition id="-14" name="Compare variable" type="System">
                                                    <param id="0" name="Variable">dialogueStep</param>
                                                    <param id="1" name="Comparison">0</param>
                                                    <param id="2" name="Value">2</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="0" name="Set text" type="DialogueText">
                                                    <param id="0" name="Text">&quot;AHUURRRRRRRRR&quot;</param>
                                                </action>
                                                <action id="-16" name="Wait" type="System">
                                                    <param id="0" name="Seconds">1.0</param>
                                                </action>
                                                <action id="-9" name="Set value" type="System">
                                                    <param id="0" name="Variable">busterCanQuitConversation</param>
                                                    <param id="1" name="Value">1</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <comment>Restore variables to their defaults here.</comment>
                        <event-block>
                            <conditions>
                                <condition id="-14" name="Compare variable" type="System">
                                    <param id="0" name="Variable">busterCanQuitConversation</param>
                                    <param id="1" name="Comparison">0</param>
                                    <param id="2" name="Value">1</param>
                                </condition>
                                <condition id="-4" name="Trigger once while true" type="System" />
                            </conditions>
                            <actions>
                                <action id="-4" name="Set layer visible" type="System">
                                    <param id="0" name="Layer">&quot;Dialogue&quot;</param>
                                    <param id="1" name="Visibility">0</param>
                                </action>
                                <action id="-14" name="Set object time scale" type="System">
                                    <param id="0" name="Object">Buster</param>
                                    <param id="1" name="Time scale">1</param>
                                </action>
                                <action id="-9" name="Set value" type="System">
                                    <param id="0" name="Variable">dialogueStep</param>
                                    <param id="1" name="Value">0</param>
                                </action>
                                <action id="-9" name="Set value" type="System">
                                    <param id="0" name="Variable">busterCanTalk</param>
                                    <param id="1" name="Value">1</param>
                                </action>
                                <action id="-16" name="Wait" type="System">
                                    <param id="0" name="Seconds">2</param>
                                </action>
                                <action id="-9" name="Set value" type="System">
                                    <param id="0" name="Variable">busterCanTalk</param>
                                    <param id="1" name="Value">0</param>
                                </action>
                                <action id="-9" name="Set value" type="System">
                                    <param id="0" name="Variable">busterCanQuitConversation</param>
                                    <param id="1" name="Value">0</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
            </sub-events>
        </event-group>
    </events>
</c2eventsheet>
